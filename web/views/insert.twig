{% extends "layout.html" %}

{% block content %}
<h1>insert.twig</h1>
<?php
function generateRandomString($length = 32) {
    $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $charactersLength = strlen($characters);
    $randomString = '';
    for ($i = 0; $i < $length; $i++) {
        $randomString .= $characters[rand(0, $charactersLength - 1)];
    }
    return $randomString;
}
// change the value of $dbuser and $dbpass to your username and password
	include 'connectvarsEECS.php';
	$conn = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);
	if (!$conn) {
		die('Could not connect: ' . mysql_error());
	}
// Escape user inputs for security
	$username = mysqli_real_escape_string($conn, $_POST['username']);
	$firstName = mysqli_real_escape_string($conn, $_POST['firstName']);
	$lastName = mysqli_real_escape_string($conn, $_POST['lastName']);
	$email = mysqli_real_escape_string($conn, $_POST['email']);
  $age = mysqli_real_escape_string($conn, $_POST['age']);
  $salt = mysqli_real_escape_string($conn, generateRandomString());
  $password = mysqli_real_escape_string($conn, $_POST['password'].$salt);
  $password = mysqli_real_escape_string($conn, sha1($password));
	$query = "INSERT INTO HW1 (username, firstName, lastName, email, password, age, salt) VALUES ('$username', '$firstName', '$lastName', '$email', '$password', '$age', '$salt')";
	if(mysqli_query($conn, $query)){
		echo "Record added successfully.";
	} else{
			$errorMessage = "Duplicate entry '" . $username . "' for key 'PRIMARY'";
			if(mysqli_error($conn) == $errorMessage)
				echo "ERROR: Username has been taken";
			else
				echo "ERROR: Could not able to execute $query. " . mysqli_error($conn);
	}
// close connection
mysqli_close($conn);
?>

{% endblock %}
